{% extends 'reservas/base.html' %}
{% block content %}
<h2>{% if object %}Editar{% else %}Nueva{% endif %} Reserva</h2>

<form method="post" id="reserva-form">
  {% csrf_token %}
  {{ form.as_p }}

  <h4>Mesas disponibles</h4>
  <div class="row g-3 mb-3">
    {% for mesa in form.mesa.field.queryset %}
    <div class="col-2">
      <button type="button" class="btn w-100 {% if mesa.ocupada %}btn-danger{% else %}btn-warning{% endif %}"
        data-mesa="{{ mesa.id }}" onclick="seleccionarMesa(this)">
        {{ mesa.numero }}
      </button>
    </div>
    {% endfor %}
  </div>

  <button type="submit" class="btn btn-success">Guardar</button>
  <a href="{% url 'reservas:list' %}" class="btn btn-secondary">Cancelar</a>
</form>

<script>
  function seleccionarMesa(btn) {
    document.querySelectorAll('[data-mesa]').forEach(b => b.classList.remove('btn-primary'));
    btn.classList.add('btn-primary');
    document.getElementById('id_mesa').value = btn.dataset.mesa;
  }
</script>
{% endblock %}